# üì§ Clase 5: Publicaci√≥n y Distribuci√≥n

## üéØ Objetivos de la Clase
- Publicar y distribuir aplicaciones Expo
- Configurar Expo Application Services (EAS)
- Generar builds nativos para iOS y Android
- Publicar en App Store y Google Play Store

---

## üìö Contenido Te√≥rico

### 1. Expo Application Services (EAS)

#### **¬øQu√© es EAS?**
**Expo Application Services (EAS)** es un conjunto de servicios en la nube que simplifica el proceso de build, testing y distribuci√≥n de aplicaciones:

- **EAS Build**: Genera builds nativos en la nube
- **EAS Submit**: Env√≠a apps a las tiendas autom√°ticamente
- **EAS Update**: Gestiona actualizaciones OTA
- **EAS Analytics**: Proporciona m√©tricas de uso

#### **Instalaci√≥n y Configuraci√≥n**
```bash
# Instalar EAS CLI
npm install -g @expo/eas-cli

# Verificar instalaci√≥n
eas --version

# Iniciar sesi√≥n en Expo
eas login

# Configurar proyecto
eas build:configure
```

#### **Configuraci√≥n del Proyecto**
```javascript
// eas.json
{
  "cli": {
    "version": ">= 3.13.3"
  },
  "build": {
    "development": {
      "developmentClient": true,
      "distribution": "internal"
    },
    "preview": {
      "distribution": "internal",
      "ios": {
        "simulator": true
      }
    },
    "production": {
      "autoIncrement": true
    }
  },
  "submit": {
    "production": {}
  }
}
```

### 2. EAS Build - Generaci√≥n de Builds

#### **Configuraci√≥n de Builds**
```bash
# Configurar build para desarrollo
eas build --profile development --platform ios

# Configurar build para preview
eas build --profile preview --platform android

# Configurar build para producci√≥n
eas build --profile production --platform all
```

#### **Configuraci√≥n Avanzada de Builds**
```javascript
// eas.json con configuraci√≥n avanzada
{
  "build": {
    "development": {
      "developmentClient": true,
      "distribution": "internal",
      "env": {
        "EXPO_PUBLIC_API_URL": "https://dev-api.miapp.com"
      },
      "ios": {
        "resourceClass": "m-medium"
      },
      "android": {
        "buildType": "apk"
      }
    },
    "preview": {
      "distribution": "internal",
      "env": {
        "EXPO_PUBLIC_API_URL": "https://staging-api.miapp.com"
      },
      "ios": {
        "simulator": true,
        "resourceClass": "m-medium"
      },
      "android": {
        "buildType": "aab"
      }
    },
    "production": {
      "autoIncrement": true,
      "env": {
        "EXPO_PUBLIC_API_URL": "https://api.miapp.com"
      },
      "ios": {
        "resourceClass": "m-large",
        "credentialsSource": "remote"
      },
      "android": {
        "buildType": "aab",
        "credentialsSource": "remote"
      }
    }
  }
}
```

#### **Configuraci√≥n de Credenciales**
```bash
# Configurar credenciales de iOS
eas credentials

# Configurar credenciales de Android
eas credentials

# Ver credenciales configuradas
eas credentials:list
```

#### **Builds Automatizados con GitHub Actions**
```yaml
# .github/workflows/eas-build.yml
name: EAS Build
on:
  push:
    branches: [main, develop]
  pull_request:
    branches: [main]

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v3

      - name: Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '18'
          cache: 'npm'

      - name: Install dependencies
        run: npm ci

      - name: Setup EAS
        uses: expo/expo-github-action@v8
        with:
          eas-version: latest
          token: ${{ secrets.EXPO_TOKEN }}

      - name: Build Android APK
        run: eas build --platform android --profile preview --non-interactive

      - name: Build iOS Simulator
        run: eas build --platform ios --profile preview --non-interactive

      - name: Upload build artifacts
        uses: actions/upload-artifact@v3
        with:
          name: build-artifacts
          path: |
            *.apk
            *.ipa
```

### 3. EAS Submit - Env√≠o a Tiendas

#### **Configuraci√≥n de Submit**
```bash
# Configurar submit para iOS
eas submit --platform ios

# Configurar submit para Android
eas submit --platform android

# Submit autom√°tico despu√©s del build
eas build --auto-submit
```

#### **Configuraci√≥n Avanzada de Submit**
```javascript
// eas.json con configuraci√≥n de submit
{
  "submit": {
    "production": {
      "ios": {
        "appleId": "your-apple-id@email.com",
        "ascAppId": "your-app-store-connect-app-id",
        "appleTeamId": "your-apple-team-id"
      },
      "android": {
        "track": "production",
        "releaseStatus": "completed"
      }
    },
    "preview": {
      "ios": {
        "appleId": "your-apple-id@email.com",
        "ascAppId": "your-app-store-connect-app-id",
        "appleTeamId": "your-apple-team-id"
      },
      "android": {
        "track": "internal"
      }
    }
  }
}
```

#### **Submit Automatizado con CI/CD**
```yaml
# .github/workflows/eas-submit.yml
name: EAS Submit
on:
  workflow_run:
    workflows: ["EAS Build"]
    types:
      - completed

jobs:
  submit:
    runs-on: ubuntu-latest
    if: ${{ github.event.workflow_run.conclusion == 'success' }}
    steps:
      - name: Checkout
        uses: actions/checkout@v3

      - name: Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '18'
          cache: 'npm'

      - name: Setup EAS
        uses: expo/expo-github-action@v8
        with:
          eas-version: latest
          token: ${{ secrets.EXPO_TOKEN }}

      - name: Submit to stores
        run: |
          if [ "${{ github.ref }}" = "refs/heads/main" ]; then
            eas submit --platform all --profile production --non-interactive
          else
            eas submit --platform all --profile preview --non-interactive
          fi
```

### 4. EAS Update - Gesti√≥n de Actualizaciones

#### **Configuraci√≥n de Updates**
```javascript
// app.json
{
  "expo": {
    "updates": {
      "enabled": true,
      "fallbackToCacheTimeout": 0,
      "url": "https://u.expo.dev/your-project-id"
    },
    "runtimeVersion": {
      "policy": "sdkVersion"
    },
    "extra": {
      "eas": {
        "projectId": "your-project-id"
      }
    }
  }
}
```

#### **Publicaci√≥n de Updates**
```bash
# Publicar update para canal de desarrollo
eas update --branch development --message "Fix de bug cr√≠tico"

# Publicar update para canal de producci√≥n
eas update --branch production --message "Nueva funcionalidad"

# Publicar update con mensaje de rollback
eas update --branch production --message "Rollback a versi√≥n estable"
```

#### **Gesti√≥n de Canales de Update**
```bash
# Crear nuevo canal
eas channel:create production

# Ver canales existentes
eas channel:list

# Ver updates en un canal
eas update:list --branch production

# Rollback a update espec√≠fico
eas update:rollback --branch production --target 12345678-1234-1234-1234-123456789012
```

### 5. Publicaci√≥n en Tiendas

#### **App Store Connect (iOS)**
```bash
# Configurar credenciales de iOS
eas credentials

# Build para App Store
eas build --platform ios --profile production

# Submit a App Store
eas submit --platform ios --profile production
```

#### **Google Play Console (Android)**
```bash
# Configurar credenciales de Android
eas credentials

# Build para Google Play
eas build --platform android --profile production

# Submit a Google Play
eas submit --platform android --profile production
```

#### **Configuraci√≥n de Metadatos**
```javascript
// app.json con metadatos para tiendas
{
  "expo": {
    "name": "Mi Aplicaci√≥n",
    "slug": "mi-aplicacion",
    "version": "1.0.0",
    "orientation": "portrait",
    "icon": "./assets/icon.png",
    "userInterfaceStyle": "light",
    "splash": {
      "image": "./assets/splash.png",
      "resizeMode": "contain",
      "backgroundColor": "#ffffff"
    },
    "ios": {
      "supportsTablet": true,
      "bundleIdentifier": "com.tuempresa.miapp",
      "buildNumber": "1",
      "infoPlist": {
        "NSCameraUsageDescription": "Esta app necesita acceso a la c√°mara para tomar fotos",
        "NSLocationWhenInUseUsageDescription": "Esta app necesita acceso a la ubicaci√≥n para mostrar contenido relevante"
      }
    },
    "android": {
      "adaptiveIcon": {
        "foregroundImage": "./assets/adaptive-icon.png",
        "backgroundColor": "#ffffff"
      },
      "package": "com.tuempresa.miapp",
      "versionCode": 1,
      "permissions": [
        "CAMERA",
        "ACCESS_FINE_LOCATION"
      ]
    }
  }
}
```

### 6. Monitoreo y Analytics

#### **EAS Analytics**
```javascript
// Configuraci√≥n de analytics
import * as Analytics from 'expo-analytics';

// Eventos personalizados
Analytics.logEvent('app_opened', {
  timestamp: new Date().toISOString(),
  user_id: 'user123',
  app_version: '1.0.0'
});

// Eventos de conversi√≥n
Analytics.logEvent('purchase_completed', {
  value: 29.99,
  currency: 'USD',
  product_id: 'premium_subscription'
});
```

#### **Configuraci√≥n de Crashlytics**
```javascript
// app.json
{
  "expo": {
    "plugins": [
      [
        "expo-build-properties",
        {
          "ios": {
            "useFrameworks": "static"
          }
        }
      ]
    ]
  }
}
```

---

## üõ†Ô∏è Ejercicios Pr√°cticos

### Ejercicio 1: Configuraci√≥n Completa de EAS
Configura EAS para tu proyecto:

**Requisitos:**
- Configurar EAS CLI y credenciales
- Crear perfiles de build para desarrollo, preview y producci√≥n
- Configurar builds automatizados con GitHub Actions
- Implementar submit autom√°tico a tiendas

**Implementaci√≥n:**
```bash
# 1. Instalar y configurar EAS
npm install -g @expo/eas-cli
eas login
eas build:configure

# 2. Configurar credenciales
eas credentials

# 3. Crear workflows de GitHub Actions
# Crear .github/workflows/eas-build.yml y eas-submit.yml
```

### Ejercicio 2: Pipeline de Build y Deploy
Implementa un pipeline completo de CI/CD:

**Requisitos:**
- Build autom√°tico en push a main/develop
- Testing autom√°tico antes del build
- Submit autom√°tico a tiendas en main
- Notificaciones de estado del build

**Implementaci√≥n:**
```yaml
# .github/workflows/complete-pipeline.yml
name: Complete Pipeline
on:
  push:
    branches: [main, develop]
  pull_request:
    branches: [main]

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: actions/setup-node@v3
        with:
          node-version: '18'
      - run: npm ci
      - run: npm test

  build:
    needs: test
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: expo/expo-github-action@v8
        with:
          eas-version: latest
          token: ${{ secrets.EXPO_TOKEN }}
      - run: eas build --platform all --profile preview

  submit:
    needs: build
    runs-on: ubuntu-latest
    if: github.ref == 'refs/heads/main'
    steps:
      - uses: actions/checkout@v3
      - uses: expo/expo-github-action@v8
        with:
          eas-version: latest
          token: ${{ secrets.EXPO_TOKEN }}
      - run: eas submit --platform all --profile production
```

### Ejercicio 3: Sistema de Updates OTA
Implementa un sistema completo de actualizaciones:

**Requisitos:**
- Configurar canales de update (development, staging, production)
- Implementar verificaci√≥n autom√°tica de updates
- Crear interfaz para gesti√≥n manual de updates
- Implementar rollback autom√°tico en caso de error

**Implementaci√≥n:**
```javascript
// services/updateManager.js
import * as Updates from 'expo-updates';
import { Alert } from 'react-native';

export class UpdateManager {
  static async checkForUpdates() {
    try {
      const update = await Updates.checkForUpdateAsync();
      return update;
    } catch (error) {
      console.error('Error checking for updates:', error);
      return null;
    }
  }

  static async applyUpdate() {
    try {
      const result = await Updates.fetchUpdateAsync();
      if (result.isNew) {
        Alert.alert(
          'Update Available',
          'A new version is available. The app will restart to apply changes.',
          [
            {
              text: 'Restart Now',
              onPress: () => Updates.reloadAsync(),
            },
            {
              text: 'Later',
              style: 'cancel',
            },
          ]
        );
      }
      return result;
    } catch (error) {
      console.error('Error applying update:', error);
      throw error;
    }
  }

  static async rollbackToPreviousVersion() {
    try {
      // Implementar l√≥gica de rollback
      console.log('Rolling back to previous version...');
      await Updates.reloadAsync();
    } catch (error) {
      console.error('Error rolling back:', error);
      throw error;
    }
  }
}
```

---

## üîç Puntos Clave

1. **EAS** simplifica todo el proceso de build, testing y distribuci√≥n
2. **EAS Build** genera builds nativos en la nube sin configuraci√≥n local
3. **EAS Submit** automatiza el env√≠o a las tiendas de aplicaciones
4. **EAS Update** gestiona actualizaciones OTA de forma eficiente
5. **GitHub Actions** permite automatizar todo el pipeline de CI/CD
6. **Los perfiles de build** permiten configuraciones espec√≠ficas por ambiente
7. **Las credenciales** se gestionan de forma segura en la nube

---

## üìñ Recursos Adicionales

- [EAS Documentation](https://docs.expo.dev/eas/)
- [EAS Build Documentation](https://docs.expo.dev/build/introduction/)
- [EAS Submit Documentation](https://docs.expo.dev/submit/introduction/)
- [EAS Update Documentation](https://docs.expo.dev/eas-update/)

---

## üéâ ¬°Clase Completada!

Has completado exitosamente la **Clase 5: Publicaci√≥n y Distribuci√≥n** üöÄ

**Lo que has aprendido:**
- ‚úÖ Configuraci√≥n completa de EAS
- ‚úÖ Generaci√≥n de builds nativos en la nube
- ‚úÖ Submit autom√°tico a tiendas de aplicaciones
- ‚úÖ Gesti√≥n de actualizaciones OTA
- ‚úÖ Automatizaci√≥n completa del pipeline

**Pr√≥ximos pasos:**
- Implementar EAS en tu proyecto
- Configurar builds automatizados
- Publicar tu primera aplicaci√≥n en las tiendas

¬°Excelente trabajo! üéØ

---

## üéâ ¬°M√≥dulo Completado!

Has completado exitosamente el **M√≥dulo 8: Expo y Desarrollo R√°pido** üöÄ

**Lo que has aprendido en todo el m√≥dulo:**
- ‚úÖ Fundamentos de Expo y configuraci√≥n del entorno
- ‚úÖ SDK de Expo y APIs nativas
- ‚úÖ Herramientas de desarrollo y debugging
- ‚úÖ Servicios en la nube de Expo
- ‚úÖ Publicaci√≥n y distribuci√≥n de aplicaciones

**Pr√≥ximos pasos:**
- Implementar todos los conocimientos en proyectos reales
- Explorar funcionalidades avanzadas de Expo
- Continuar con el siguiente m√≥dulo del curso

¬°Felicidades por completar el m√≥dulo de Expo! üéØ

---

## üîó Navegaci√≥n del M√≥dulo

### **Clase Anterior**: [Clase 4: Servicios de Expo](clase_4_servicios_expo.md)
### **Volver al M√≥dulo**: [M√≥dulo 8: Expo y Desarrollo R√°pido](README.md)
### **M√≥dulo Siguiente**: [M√≥dulo 9: Patrones de Dise√±o](../senior_1/README.md)
### **Volver al Inicio**: [√çndice Completo](../INDICE_COMPLETO.md)
